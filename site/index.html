<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/bootstrap/3.3.4/css/bootstrap.min.css">
	<title>NED ORC sailboat data.</title>

	<link rel="stylesheet" href="polarplot.css">
</head>
<body>
	<div class="navbar navbar-default navbar-static-top" role="navigation" id="main-nav">
		<div class="navbar-header">
			<button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#main-navigation">
				<span class="sr-only">Toggle navigation</span>
				<span class="icon-bar"></span>
				<span class="icon-bar"></span>
				<span class="icon-bar"></span>
			</button>
			<a class="navbar-brand">ORC sailboat data (NED)</a>
		</div>
		<div class="collapse navbar-collapse" id="main-navigation">
			<form class="navbar-form navbar-left" role="search">
        		<div class="input-group">
					<input type="text" class="form-control" placeholder="naam, type, eigenaar of zeilnummer..." />
					<span class="input-group-btn">
						<button class="btn btn-default"><i class="glyphicon glyphicon-search"></i></button>
					</span>
				</div>
			</form>

			<p class="navbar-text navbar-left">
				Site: <a href="http://twitter.com/jietermanis">@Jietermanis</a>,
				Data:
				<a href="http://orc.org/index.asp?id=44">&copy; ORC.org</a>
			</p>
		</div>
	</div>
	<div class="row-offcanvas row-offcanvas-left">
		<div id="sidebar" class="sidebar-offcanvas">
			<div class="col-md-12">
				<ul class="nav nav-pills nav-stacked" id="list">

				</ul>
			</div>
		</div>
		<div id="main">
			<div class="col-md-12">
				<div class="row">
					<div class="visible-xs col-xs-2 sidebar-toggle">
						<button type="button" class="btn btn-primary btn-sm" data-toggle="offcanvas">
							<i class="glyphicon glyphicon-menu-hamburger"></i>
						</button>
					</div>
					<h1 class="col-sm-offset-6 col-sm-6 col-xs-10" id="name">
						Bootnaam
					</h1>
				</div>
				<div class="row">
					<div class="col-lg-5 col-sm-6" id="chart"></div>
					<div class="col-lg-7 col-sm-6" id="meta"></div>
				</div>
			</div>
		</div>
	</div>

	<script src="http://d3js.org/d3.v3.min.js"></script>
	<script src="polarplot.js"></script>

	<script src="//code.jquery.com/jquery-2.1.4.min.js"></script>
	<script src="//maxcdn.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.js"></script>
	<script>
		$(document).ready(function() {
			$('[data-toggle=offcanvas]').click(function() {
				$('.row-offcanvas').toggleClass('active');
			});
		});
		var list = d3.select('#list');
		var plot = polarplot('#chart');

		function getRandomElement(arr) {
			return arr[Math.floor(Math.random() * arr.length)];
		}

		function match_boats(data, needle) {
			var needle = needle.toLowerCase();
			var values = [data.name, data.sailnumber, data.owner, data.boat.type];

			for (var i in values) {
				var value = values[i];
				if (value.toLowerCase().indexOf(needle) != -1) {
					return true;
				}
			}
		}

		d3.json('../NED2015.json', function (response) {
			list.selectAll('li')
				.data(response)
				.enter()
					.append('li').append('a')
					.attr({href: function (d) { return '#' + d.sailnumber}, class: 'boat'})
					.on('click', function (d) {
						plot.render(d);
					})
					.html(function (d) {
						return '<span class="sailnumber">' + d.sailnumber + '</span> ' + d.name +
							   '<br /><span class="type">' + d.boat.type + '</span>';
					});
			if (window.location.hash == '') {
				plot.render(getRandomElement(response));
			} else {
				var sailnumber = window.location.hash.substring(1);

				response.forEach(function (boat) {
					if (boat.sailnumber == sailnumber) {
						plot.render(boat);
					}
				});
			}
		});

		function search () {
			var val = d3.select('input').property('value');

			if (val == '') {
				list.selectAll('a').attr('class', 'boat');
			}
			list.selectAll('a')
				.attr('class', function (d) {
					return 'boat' + (!match_boats(d, val) ? ' hidden' : '');
				});
			if (list.selectAll('a:not(.hidden)')[0].length == 1) {
				plot.render(list.selectAll('a:not(.hidden)').data()[0])
			}
		}
		d3.select('input').on('keyup', search);
		d3.select('button').on('click', search);

		d3.select(window).on('resize', function () {
			plot.resize();
		})


	</script>
</body>
</html>
