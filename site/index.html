<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/css/bootstrap.min.css">
	<title>NED ORC sailboat data.</title>
<style>
	svg text {
		font: 10px sans-serif;
	}

	.axis line,	.axis circle {
		fill: none;
		stroke: #777;
		stroke-dasharray: 1,4;
	}

	.axis :last-of-type circle {
		stroke: #333;
		stroke-dasharray: none;
	}

	.line {
		fill: none;
		stroke: red;
		stroke-width: 1.5px;
	}

	.meta span.meta-label {
		font-weight: 200;
		font-size: 14px;
		color: #aaa;
		padding: 0;
		display: inline-block;;
		min-width: 100px;

	}
	input { margin-bottom: 2px; }
	.meta-item h2 { margin-top: 2px; }

	#list {
		height: 650px;
		overflow-y: scroll;
	}
	.boat {
		padding: 2px 5px;
		display: block;
	}
	.sailnumber {
		color: #555;
		padding-right: 5px;
		display: inline-block;
		min-width: 75px;
	}
	h2 .sailnumber { font-size: 13px; }
	.type {
		color: #aaa;
		size: 10px;
	}

	/* sticky footer */
	html {
		position: relative;
		min-height: 100%;
	}
	body {
		/* Margin bottom by footer height */
		margin-bottom: 60px;
	}
	.footer {
		position: absolute;
		bottom: 0;
		width: 100%;
		/* Set the fixed height of the footer here */
		height: 60px;
		background-color: #f5f5f5;
	}
	.container .text-muted {
		margin: 20px 0;
	}
</style>
</head>
<body>
	<div class="navbar navbar-default" role="navigation" id="main-nav">
		<div class="container">
			<div class="navbar-header">
				<button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#main-navigation">
					<span class="sr-only">Toggle navigation</span>
					<span class="icon-bar"></span>
					<span class="icon-bar"></span>
					<span class="icon-bar"></span>
				</button>
				<a class="navbar-brand">ORC club sailboat data</a>
			</div>
			<div class="collapse navbar-collapse">
				<ul class="nav navbar-nav">
					<li><a href="http://twitter.com/jietermanis">
							@Jietermanis
						</a></li>
				</ul>
			</div>
		</div>
	</div>
	<div class="container">
		<div class="row">
			<div class="col-sm-4">
				<input type="text" class="form-control" placeholder="naam, type, eigenaar of zeilnummer..." />
				<div id="list"></div>
			</div>
			<div class="col-sm-4" id="chart"></div>
			<div class="col-sm-4" id="meta"></div>

		</div>
	</div>
	<footer id="footer" class="footer">
		<div class="container">
			<div class="text-muted text-right">
				<a href="http://orc.org/index.asp?id=44">Data &copy; ORC.org</a>
			</div>
		</div>
	</footer>

	<script src="http://d3js.org/d3.v3.min.js"></script>
	<script src="polarplot.js"></script>
	<script>
		var list = d3.select('#list');
		var plot = polarplot('#chart');

		function match_boats(data, needle) {
			var needle = needle.toLowerCase();
			var values = [data.name, data.sailnumber, data.owner, data.boat.type];

			for (var i in values) {
				var value = values[i];
				if (value.toLowerCase().indexOf(needle) != -1) {
					return true;
				}
			}
		}

		d3.json('../NED2015.json', function (response) {
			list.selectAll('a')
				.data(response)
				.enter()
					.append('a')
					.attr({href: '#', class: 'boat'})
					.on('click', function (d) {
						plot.render(d);
					})
					.html(function (d) {
						return '<span class="sailnumber">' + d.sailnumber + '</span> ' + d.name +
							   ' <span class="type">' + d.boat.type + '</span>';
					});
		});

		d3.select('input').on('keyup', function () {
			var val = d3.select(this).property('value');

			if (val == '') {
				list.selectAll('a').attr('class', 'boat');
			}
			list.selectAll('a')
				.attr('class', function (d) {
					return 'boat' + (!match_boats(d, val) ? ' hidden' : '');
				});
			if (list.selectAll('a:not(.hidden)')[0].length == 1) {
				plot.render(list.selectAll('a:not(.hidden)').data()[0])
			}
		});
	</script>
</body>
</html>
