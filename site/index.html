<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/css/bootstrap.min.css">

<style>
	svg text {
		font: 10px sans-serif;
	}

	.axis line,	.axis circle {
		fill: none;
		stroke: #777;
		stroke-dasharray: 1,4;
	}

	.axis :last-of-type circle {
		stroke: #333;
		stroke-dasharray: none;
	}

	.line {
		fill: none;
		stroke: red;
		stroke-width: 1.5px;
	}

	.meta text {
	    font-size: 13px;
	}

	#list {
	    height: 600px;
	    overflow-y: scroll;
	}
	.boat {
	    padding: 2px 5px;
	    display: block;
	}
	.sailnumber {
	    color: #555;
	    padding-right: 5px;
	    display: inline-block;
	    min-width: 75px;
	}
	.type {
	    color: #aaa;
	    size: 10px;
	}
</style>
</head>
<body class="container">
    <h2>
        ORC Club NL sailboat data
    </h2>
    <div class="row">
        <div class="col-md-5">
            <input type="text" class="form-control" placeholder="naam, type, eigenaar of zeilnummer..." />
            <div id="list">

            </div>
        </div>
        <div class="col-md-7" id="chart">
        </div>
    </div>
	<div class="row">
		<div class="col-md-12 text-right">
			<a href="http://orc.org/index.asp?id=44">Data courtesy ORC.org</a>
		</div>
	</div>


	<script src="http://d3js.org/d3.v3.min.js"></script>
	<script src="polarplot.js"></script>
	<script>
	    var list = d3.select('#list');
	    var plot = polarplot('#chart');

	    function match_boats(data, needle) {
	        var needle = needle.toLowerCase();
	        var values = [data.name, data.sailnumber, data.owner, data.boat.type];

	        for (var i in values) {
	            var value = values[i];
	            if (value.toLowerCase().indexOf(needle) != -1) {
	                return true;
	            }
	        }
	    }

	    d3.json('../NED2015.json', function (response) {
	        list.selectAll('a')
	            .data(response)
	            .enter()
	                .append('a')
	                .attr({href: '#', class: 'boat'})
	                .on('click', function (d) {
	                    plot.render(d);
	                })
	                .html(function (d) {
	                    return '<span class="sailnumber">' + d.sailnumber + '</span> ' + d.name +
	                           ' <span class="type">' + d.boat.type + '</span>';
	                });
	    });

	    d3.select('input').on('keyup', function () {
	        var val = d3.select(this).property('value');

	        if (val == '') {
	            list.selectAll('a').attr('class', 'boat');
	        }
	        list.selectAll('a')
	            .attr('class', function (d) {
	                return 'boat' + (!match_boats(d, val) ? ' hidden' : '');
	            });
	        if (list.selectAll('a:not(.hidden)')[0].length == 1) {
	            plot.render(list.selectAll('a:not(.hidden)').data()[0])
	        }
	    });
	</script>
</body>
</html>
